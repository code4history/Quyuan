<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qy-Swiper Debug Test</title>
  <script type="module">
    import './dist/quyuan.js';
    
    window.addEventListener('DOMContentLoaded', () => {
      const swiper = document.querySelector('qy-swiper');
      
      // Test 1: Check initial state
      console.log('=== Initial State ===');
      console.log('Swiper element:', swiper);
      console.log('Has shadow root:', !!swiper.shadowRoot);
      
      customElements.whenDefined('qy-swiper').then(() => {
        console.log('=== After qy-swiper defined ===');
        
        // Test 2: Check slides collection
        setTimeout(() => {
          console.log('Checking slides...');
          const slides = swiper.slides;
          console.log('Number of slides:', slides.length);
          
          // Test 3: Check shadow DOM structure
          const shadowRoot = swiper.shadowRoot;
          if (shadowRoot) {
            const divSlides = shadowRoot.querySelector('#divSlides');
            console.log('Found #divSlides:', !!divSlides);
            if (divSlides) {
              console.log('Children in #divSlides:', divSlides.children.length);
              console.log('HTML in #divSlides:', divSlides.innerHTML);
            }
            
            // Check if swiper initialized
            const swiperContainer = shadowRoot.querySelector('.swiper');
            console.log('Found .swiper container:', !!swiperContainer);
            console.log('Has swiper-initialized class:', swiperContainer?.classList.contains('swiper-initialized'));
          }
          
          // Test 4: Try to access internal Swiper instance
          console.log('Internal slider instance:', !!(swiper as any).slider);
          
          // Test 5: Add a slide dynamically
          console.log('=== Adding slide dynamically ===');
          const newSlide = document.createElement('qy-swiper-slide');
          newSlide.setAttribute('thumbnail-url', 'https://images.pexels.com/photos/1619317/pexels-photo-1619317.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500');
          newSlide.setAttribute('image-url', 'https://images.pexels.com/photos/1619317/pexels-photo-1619317.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260');
          newSlide.setAttribute('image-type', 'image');
          newSlide.setAttribute('caption', 'Dynamically added slide');
          swiper.appendChild(newSlide);
          
          // Check if slides updated
          setTimeout(() => {
            console.log('After adding slide - number of slides:', swiper.slides.length);
          }, 1000);
        }, 500);
      });
    });
  </script>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    qy-swiper {
      width: 100%;
      height: 500px;
      display: block;
      border: 1px solid #ccc;
    }
    .controls {
      margin-top: 20px;
    }
    button {
      padding: 10px 20px;
      margin-right: 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Qy-Swiper Debug Test</h1>
    
    <qy-swiper has-thumb>
      <qy-swiper-slide
        thumbnail-url="https://images.pexels.com/photos/414612/pexels-photo-414612.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500"
        image-url="https://images.pexels.com/photos/414612/pexels-photo-414612.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260"
        image-type="image"
        caption="Beautiful beach sunset">
      </qy-swiper-slide>
      
      <qy-swiper-slide
        thumbnail-url="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500"
        image-url="https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260"
        image-type="image"
        caption="Cute golden retrievers">
      </qy-swiper-slide>
    </qy-swiper>
    
    <div class="controls">
      <button onclick="checkState()">Check State</button>
      <button onclick="addSlide()">Add Slide</button>
      <button onclick="forceRender()">Force Re-render</button>
    </div>
    
    <pre id="output" style="margin-top: 20px; background: #f5f5f5; padding: 10px; border-radius: 5px;"></pre>
  </div>
  
  <script>
    function checkState() {
      const swiper = document.querySelector('qy-swiper');
      const output = {
        hasSwiper: !!swiper,
        slideCount: swiper?.slides?.length || 0,
        hasShadowRoot: !!swiper?.shadowRoot,
        swiperInitialized: !!(swiper as any)?.slider
      };
      document.getElementById('output').textContent = JSON.stringify(output, null, 2);
    }
    
    function addSlide() {
      const swiper = document.querySelector('qy-swiper');
      const newSlide = document.createElement('qy-swiper-slide');
      newSlide.setAttribute('thumbnail-url', 'https://images.pexels.com/photos/1619317/pexels-photo-1619317.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500');
      newSlide.setAttribute('image-url', 'https://images.pexels.com/photos/1619317/pexels-photo-1619317.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260');
      newSlide.setAttribute('image-type', 'image');
      newSlide.setAttribute('caption', `Dynamic slide ${Date.now()}`);
      swiper.appendChild(newSlide);
      
      setTimeout(checkState, 100);
    }
    
    function forceRender() {
      const swiper = document.querySelector('qy-swiper');
      if (swiper && typeof (swiper as any).render === 'function') {
        (swiper as any).render();
        setTimeout(checkState, 100);
      }
    }
  </script>
</body>
</html>